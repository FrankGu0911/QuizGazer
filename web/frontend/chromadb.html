<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChromaDB æŸ¥è¯¢</title>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <style>
        :root {
            --bg-primary: #f5f7fa;
            --bg-secondary: #ffffff;
            --text-primary: #303133;
            --text-secondary: #606266;
            --border-color: #ebeef5;
            --shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .dark-theme {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --text-primary: #e0e0e0;
            --text-secondary: #b0b0b0;
            --border-color: #404040;
            --shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        #app {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .page-header {
            background: var(--bg-secondary);
            padding: 24px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .page-header h1 {
            font-size: 28px;
            margin-bottom: 16px;
        }

        .header-actions {
            display: flex;
            gap: 12px;
            justify-content: space-between;
            align-items: center;
        }

        .query-section {
            background: var(--bg-secondary);
            padding: 24px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .results-section {
            background: var(--bg-secondary);
            padding: 24px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .result-card {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            transition: all 0.3s;
        }

        .result-card:hover {
            box-shadow: var(--shadow);
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .result-content {
            line-height: 1.6;
            color: var(--text-secondary);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .metadata {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
            font-size: 12px;
            color: var(--text-secondary);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .collection-info {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .info-card {
            flex: 1;
            min-width: 200px;
            padding: 16px;
            background: var(--bg-primary);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .info-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .info-value {
            font-size: 20px;
            font-weight: bold;
            color: #409eff;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="page-header">
            <h1>ğŸ” ChromaDB æŸ¥è¯¢</h1>
            <div class="header-actions">
                <div>
                    <el-button @click="loadCollections" :loading="loading" type="primary">
                        ğŸ”„ åˆ·æ–°é›†åˆ
                    </el-button>
                    <el-button @click="checkConfig" type="info" plain>
                        ğŸ”§ æ£€æŸ¥é…ç½®
                    </el-button>
                    <el-button @click="goBack" type="info" plain>
                        â† è¿”å›å†å²è®°å½•
                    </el-button>
                </div>
                <el-button @click="logout" type="warning" plain>
                    ğŸ‘¤ {{ currentUsername }} | é€€å‡º
                </el-button>
            </div>
        </div>

        <div class="collection-info" v-if="collections.length > 0">
            <div class="info-card">
                <div class="info-label">é›†åˆæ€»æ•°</div>
                <div class="info-value">{{ collections.length }}</div>
            </div>
            <div class="info-card" v-if="selectedCollection">
                <div class="info-label">å½“å‰é›†åˆ</div>
                <div class="info-value" style="font-size: 16px;">{{ selectedCollection }}</div>
            </div>
            <div class="info-card" v-if="currentCollectionInfo">
                <div class="info-label">æ–‡æ¡£æ•°é‡</div>
                <div class="info-value">{{ currentCollectionInfo.count }}</div>
            </div>
        </div>

        <div class="query-section">
            <el-form label-width="100px">
                <el-form-item label="é€‰æ‹©é›†åˆ">
                    <el-select 
                        v-model="selectedCollection" 
                        placeholder="è¯·é€‰æ‹©é›†åˆ" 
                        @change="onCollectionChange"
                        style="width: 100%;"
                        :loading="loading">
                        <el-option 
                            v-for="col in collections" 
                            :key="col.name" 
                            :label="`${col.name} (${col.count} æ¡)`" 
                            :value="col.name">
                        </el-option>
                    </el-select>
                </el-form-item>

                <el-form-item label="æŸ¥è¯¢å…³é”®è¯">
                    <el-input 
                        v-model="queryText" 
                        placeholder="è¾“å…¥æŸ¥è¯¢å…³é”®è¯..."
                        @keyup.enter="executeQuery"
                        :disabled="!selectedCollection">
                    </el-input>
                </el-form-item>

                <el-form-item label="è¿”å›æ•°é‡">
                    <el-input-number 
                        v-model="nResults" 
                        :min="1" 
                        :max="100"
                        :disabled="!selectedCollection">
                    </el-input-number>
                </el-form-item>

                <el-form-item>
                    <el-button 
                        type="primary" 
                        @click="executeQuery" 
                        :loading="querying"
                        :disabled="!selectedCollection || !queryText">
                        ğŸ” æŸ¥è¯¢
                    </el-button>
                    <el-button 
                        @click="loadSample" 
                        :loading="loadingSample"
                        :disabled="!selectedCollection">
                        ğŸ“‹ æŸ¥çœ‹ç¤ºä¾‹æ•°æ®
                    </el-button>
                </el-form-item>
            </el-form>
        </div>

        <div class="results-section" v-if="results.length > 0 || showingSample">
            <h3 style="margin-bottom: 16px;">
                {{ showingSample ? 'ç¤ºä¾‹æ•°æ®' : 'æŸ¥è¯¢ç»“æœ' }}
                <el-tag type="info" style="margin-left: 12px;">å…± {{ results.length }} æ¡</el-tag>
            </h3>

            <div v-for="(result, index) in results" :key="result.id" class="result-card">
                <div class="result-header">
                    <div>
                        <el-tag size="small">{{ index + 1 }}</el-tag>
                        <el-tag size="small" type="info" style="margin-left: 8px;">
                            ID: {{ result.id }}
                        </el-tag>
                        <el-tag 
                            v-if="result.distance !== undefined" 
                            size="small" 
                            :type="result.distance < 0.5 ? 'success' : result.distance < 1.0 ? 'warning' : 'danger'"
                            style="margin-left: 8px;">
                            è·ç¦»: {{ result.distance.toFixed(4) }}
                        </el-tag>
                    </div>
                </div>

                <div class="result-content">{{ result.document }}</div>

                <div class="metadata" v-if="result.metadata && Object.keys(result.metadata).length > 0">
                    <strong>å…ƒæ•°æ®:</strong>
                    <pre style="margin-top: 8px;">{{ JSON.stringify(result.metadata, null, 2) }}</pre>
                </div>
            </div>
        </div>

        <div class="results-section" v-else-if="!loading && collections.length > 0">
            <div class="empty-state">
                <div style="font-size: 48px; margin-bottom: 16px;">ğŸ”</div>
                <p>é€‰æ‹©é›†åˆå¹¶è¾“å…¥å…³é”®è¯å¼€å§‹æŸ¥è¯¢</p>
            </div>
        </div>

        <div class="results-section" v-else-if="!loading && collections.length === 0">
            <div class="empty-state">
                <div style="font-size: 48px; margin-bottom: 16px;">ğŸ“¦</div>
                <p>æš‚æ— å¯ç”¨çš„é›†åˆ</p>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus"></script>
    <script src="chromadb.js"></script>
</body>
</html>
